name: NGROK-PUTTY-BAGLANTISI

on:
  workflow_dispatch:

jobs:
  terminal-ac:
    runs-on: ubuntu-latest
    steps:
      - name: Sifre ve SSH Ayarla
        run: |
          # KullanÄ±cÄ±: runner | Sifre: 123456
          echo "runner:123456" | sudo chpasswd
          sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
          sudo service ssh restart

      - name: Ngrok Kur ve Bagla
        run: |
          # GÃ¼ncel Ngrok indirme linki
          curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc >/dev/null
          echo "deb https://ngrok-agent.s3.amazonaws.com buster main" | sudo tee /etc/apt/sources.list.d/ngrok.list
          sudo apt update && sudo apt install ngrok
          
          # Token ekleme ve baÅŸlatma
          ngrok config add-authtoken ${{ secrets.NGROK_TOKEN }}
          ngrok tcp 22 &
          sleep 10

      - name: Adresi Al
        run: |
          echo "--------------------------------------------------"
          echo "ðŸ‘‡ðŸ‘‡ PUTTY ADRESI ASAGIDA ðŸ‘‡ðŸ‘‡"
          # Ngrok adresini Ã§ekmenin en saÄŸlam yolu
          curl -s http://localhost:4040/api/tunnels | grep -o 'tcp://[^"]*'
          echo "Kullanici: runner | Sifre: 123456"
          echo "--------------------------------------------------"
          
      - name: Bekle
        run: sleep 21600
